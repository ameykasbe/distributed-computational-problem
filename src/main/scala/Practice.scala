import java.util.StringTokenizer
import scala.util.matching.Regex
import org.apache.hadoop.io.{IntWritable, Text}
import com.github.nscala_time.time.Imports.*
import org.joda.time.LocalTime
import com.typesafe.config._
import org.apache.hadoop.io.{IntWritable, Text}
import org.apache.hadoop.mapreduce.Mapper
import org.joda.time.LocalTime
import com.github.nscala_time.time.Imports.*

import java.util.StringTokenizer
import com.typesafe.config._

object Practice {

  val config = ConfigFactory.load()
  val initialTime = config.getString("DistributionMessageType.initialTime")
  val finalTime = config.getString("DistributionMessageType.finalTime")
  val timeRegex = config.getString("DistributionMessageType.timeRegex")
  val messageTypeRegex = config.getString("DistributionMessageType.messageTypeRegex")
  val patternRegex = config.getString("DistributionMessageType.patternRegex")


  def main(args: Array[String]): Unit = {
    val one = new IntWritable(1) // Integer datatype of hadoop
    val word = new Text() // Apache text object, store text using standard UTF8 encoding

    val value = "10:44:57.835 [main] INFO  GenerateLogData$ - Log data generator started...\n10:44:58.108 [main] WARN  HelperUtils.Parameters$ - Max count 100 is used to create records instead of timeouts\n10:44:58.173 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - [:l%[5iH.kaghsJVP4cF@c]f\n10:44:58.185 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - Y*h\\7~`A?aghsCRwJ_\"fx$\n10:44:58.201 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - i}Vy9/vLaghsR4yV2?]h\n10:44:58.217 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - fkqR<%laghslwPy7jy\n10:44:58.233 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - \\BIO6nrTaghsXgLImz9B\n10:44:58.249 [scala-execution-context-global-17] DEBUG HelperUtils.Parameters$ - rwn1)uaghseyi}\"/\n10:44:58.264 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - 5&('kRaghstT~}IE\n10:44:58.279 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - +3>0')0(aghsc)>r+|G%\n10:44:58.295 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - !'CZgv+e$aghsMW1J0MWl'\n10:44:58.311 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - FKVO;'nEaghsa1?:4Igl\n10:44:58.328 [scala-execution-context-global-17] ERROR HelperUtils.Parameters$ - A+t4A(4aghsmmThWBK\n10:44:58.343 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - id[`XfaghsbNf#z!\n10:44:58.359 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - :cm+P<aghsvC^Z.}\n10:44:58.375 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - \"y\\H9s^IImaghs\"6w]I[g3#^\n10:44:58.390 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - \"Q]B@laghs5(R+Rv\n10:44:58.406 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - s9kF;NR{I8aghs83[9g5VY|x\n10:44:58.422 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - '&*.YZS!aghsj=wFZ-Lc\n10:44:58.436 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - orrj:A'.?aghs6@OJGXi|Q\n10:44:58.452 [scala-execution-context-global-17] DEBUG HelperUtils.Parameters$ - Z_)w#7,rqaghs:HG~&a7G%\n10:44:58.467 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - E)u=Y,X1baghs%|m},vyZe\n10:44:58.483 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - VX6l=j@(aghs$sxwufx^,\n10:44:58.499 [scala-execution-context-global-17] DEBUG HelperUtils.Parameters$ - D200(autyg+7>h/|\n10:44:58.515 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - )2L!%o'(P`utygdHH9P$<+#l\n10:44:58.531 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - &{_4+5GF5utyg&~@#5aD^\"\n10:44:58.547 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - [!}%k?,tXnutygob`jefnhX8\n10:44:58.563 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - E=mK58!Mutyg>*v/3E(^\n10:44:58.578 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - 9:aQ#P&rutyg`f]O:$D+\n10:44:58.594 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - 7+g-PZ,utygab^RC=;\n10:44:58.609 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - }O&Lvo@%utygJ-7.9Z_Q\n10:44:58.624 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - P,WY)*f{abcdS/.;`HV%\n10:44:58.640 [scala-execution-context-global-17] ERROR HelperUtils.Parameters$ - ,\"5:>p1111ULKl8H\n10:44:58.657 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - |Y&Q6&=E1111PW8&-8QP\n10:44:58.672 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - *pM|(C/-ur11117M$bz=^?m<\n10:44:58.687 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - :UB!L_~!K<1111G$-vp`?a8H\n10:44:58.702 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - '/Q?hcN1111|o4=>\">\n10:44:58.717 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - nwvL^YWh1111t{Q,~b}~\n10:44:58.733 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - \\t?;1ko1111,Hv|k?\\\n10:44:58.748 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - m&4<]ojK\\T1111p4B[z2W4WH\n10:44:58.763 [scala-execution-context-global-17] DEBUG HelperUtils.Parameters$ - jUeJPh1111_<*B!I\n10:44:58.779 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - W>r[Vf1111}Q;ue&\n10:44:58.794 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - WPJ:bIZ1111'Wry$TC\n10:44:58.810 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - >pG;YZz1111pMY)Nu?\n10:44:58.827 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - PoW%/?et#31111$<(,O-D4f(\n10:44:58.842 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - FnrV|z8e]21111DCk>:8;+>N\n10:44:58.858 [scala-execution-context-global-17] DEBUG HelperUtils.Parameters$ - FNwVB;c1111oJ(Xd2(\n10:44:58.874 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - %N>\\Jhj[/1111Xwrn6-@)#\n10:44:58.888 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - l;8<1Os111183oYZSe\n10:44:58.903 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - r|Jm^k1111?a]T:6\n10:44:58.918 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - M-\\3'**1111o{~)jz{\n10:44:58.933 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - -YiO*hbd11119}rW|'{J\n10:44:58.949 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - 1.Fj:#y-j&1111y8y>|45\\7j\n10:44:58.966 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - Fw=R:7@G?1111=u`IY}J6&\n10:44:58.981 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - 3b\"hH?;0G1111V-Ntu?\"nn\n10:44:58.996 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - o!oEN2q4n]1111Z~P+PpCatm\n10:44:59.012 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - +7DctEpM1111&#jS@l3D\n10:44:59.028 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - HmtyvKxf=/11118ru\"YN`np>\n10:44:59.044 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - TQlSl/N~N{1111({>uVa?R<6\n10:44:59.060 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - kba|Z;R51111I759H1_9\n10:44:59.076 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - 8)c^1U1111*Nm\\^!\n10:44:59.091 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - Te8'8%>lq11115NPi'/>e'\n10:44:59.107 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - 40b'8RA1111Kw_lBc#\n10:44:59.122 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - 9Yz>blGk1111Eo:ePy8l\n10:44:59.136 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - _8BD[h}F1111){[_'F$X\n10:44:59.152 [scala-execution-context-global-17] DEBUG HelperUtils.Parameters$ - $ZQ{|Phze>1111*&eK]Ii9Nm\n10:44:59.168 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - L=VGf)1111YENox;\n10:44:59.184 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - W`*Ou4ZC1111l'qJBUOx\n10:44:59.199 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - hg.Em/uC11114[^od>+z\n10:44:59.215 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - al#OchF^w1111YJ@?#M!.6\n10:44:59.231 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - 7fKN^?$9`)1111Ed665I]gb@\n10:44:59.247 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - jicn,%]rwN1111evY!.Ibu.o\n10:44:59.263 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - (m{zvR1111cNWsqf\n10:44:59.279 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - %wV<H[{!211119DJ,]dEE4\n10:44:59.295 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - #6\\PKmb9>e1111y|EQwS.,V`\n10:44:59.311 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - Q7@x*Ql1111H=%8GZf\n10:44:59.326 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - ol2V$'1111YQI6;^\n10:44:59.342 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - ,cihNOS;1111x@=&qp0\n10:44:59.357 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - U!8<NL>PKx1111!.sTu:HR9m\n10:44:59.373 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - -Sa_um[}^f1111HmfoXXyEVI\n10:44:59.388 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - 5`%\"78)1111&wunZ@N\n10:44:59.404 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - F3ThkuHfSU1111ZmA\\i.:5'I\n10:44:59.419 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - `wN8hj1111>}JQ<.\n10:44:59.435 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - MARu\\=1111lyPgpt\n10:44:59.451 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - 5A84)fiP1111IV<MQQ7~\n10:44:59.467 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - (;TMT)T(11110[NAy9EJ\n10:44:59.483 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - gOe9M~1111b7-]fe\n10:44:59.500 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - \\G\"A1K}\"1111kPy`thup\n10:44:59.515 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - )ciZ=R%11118J<'^fh\n10:44:59.530 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - ^Ag6xy7K_11116bMNT@^l7\n10:44:59.546 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - v`0O&-1111oUs[!d\n10:44:59.562 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - <+05u.m1111Rui3YF3\n10:44:59.576 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - Wo_u.x1111lnd3]E\n10:44:59.592 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - E;B5Hm1111&+M?pK\n10:44:59.607 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - Ub\"Dmh[1111Lm!*V@5\n10:44:59.622 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - -]f;\\N1111ux2pkl\n10:44:59.639 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - yWKMxcP41111_~KvsO9v\n10:44:59.654 [scala-execution-context-global-17] WARN  HelperUtils.Parameters$ - Vt(r'H}1111cJXC}n|\n10:44:59.671 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - \\@</G\\[E.1111X\\(ZU4@E0\n10:44:59.687 [scala-execution-context-global-17] INFO  HelperUtils.Parameters$ - 1]Mba1Ea)1111q3SXKs-Gh\n10:44:59.701 [scala-execution-context-global-17] DEBUG HelperUtils.Parameters$ - reJ<L1fKKn1111iH\"S*XRD>+\n10:44:59.716 [scala-execution-context-global-17] ERROR  HelperUtils.Parameters$ - zJZhz7`DN1111>6cl1t{wZ\n10:44:59.717 [main] INFO  GenerateLogData$ - Log data generation has completed after generating 100 records."
    val itr = new StringTokenizer(value.toString, "\n") // Tokenizes using default delimiter set, which is " \t\n\r\f". Elements are in String
    val initial_time = LocalTime.parse(initialTime) // The time frame's initial time (inclusive)
    val final_time = LocalTime.parse(finalTime) // The time frame's ending time (inclusive)

    while (itr.hasMoreTokens()) {
      val str = itr.nextToken() // Single log event
      val pattern = timeRegex.r // scala.util.matching.Regex instance with time pattern
      val option_string_match = pattern.findFirstIn(str) // Finds first occurence of pattern and returns Option[String]
      option_string_match match {
        case Some(s) => {
          val t = LocalTime.parse(s) // Time of the log event
          if ((t >= initial_time) && (t <= final_time)){ // Comparing time
            val pattern3 = patternRegex.r
            val patternMessage = pattern3.findFirstIn(str)
            patternMessage match{
              case Some(sp) => {
                val pattern2 = messageTypeRegex.r // scala.util.matching.Regex instance with message type pattern
                val match_message_type = pattern2.findFirstIn(str) // Finding message type
                match_message_type match {
                  case Some(sm) => {
                    word.set(sm) // Converting from Option[String] to Hadoop Text instance
                    println(word) // Key = MESSAGE TYPE, VALUE = 1
                  }
                  case None => // If pattern is not found - Do nothing
                }
              }
              case None => // If pattern not found - Do nothing
            }
          }
        }
        case None => // If pattern is not found - Do nothing
      }
    }
  }
}

